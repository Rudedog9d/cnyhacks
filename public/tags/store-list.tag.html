<store-list>
  <div id="item-container" class="row">
    <div class="col-12 cards-container">
      <item-card ref="items" each="{ item in items }" item="{ item }"></item-card>

      <!-- Cookie Monster Card -->
      <div class="card hoverable" style="width: 100%">
        <div class="card-image">
          <img src="/resources/memes/cookie-monster.jpg" onerror="this.onerror=null;this.src='/images/question-mark-pewdiepie.jpg';">
          <span class="card-title white black-text">Cookie Monster - <small>1 Cookie</small></span>
        </div>
        <div class="card-content">
          <p>I am hungry. Feed me!</p>
        </div>
        <div class="card-action">
          <a onclick="{onCookieClick}" href="#">Purchase</a>
        </div>
      </div>
    </div>
  </div>

  <item-modal ref="modal"></item-modal>

  <div id="cm-modal" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Cookie Monster</h4>
      <p>I've been craving some fresh cookies lately. Do you have one for me?</p>
      <div class="input-field col s6">
        <input placeholder="s%3AHVdyEkdETirJ2wWXFlnD4Bp3VlKzWfwq.Ujbpaa%2BxaUOZDrux%2F%2F%2BFz5Fcepl4nOJ%2BcbSX4IqKHoQ" id="cm-input" type="text">
        <label for="cm-input">Cookie</label>
      </div>

      <div class="divider" style="margin: 1rem"></div>
      
    </div>
    <div class="modal-footer">
      <a href="javascript:void(0)" class="waves-effect waves-green btn-flat" onclick="{onCookieSubmit}">
        Submit
      </a>
      <a href="javascript:void(0)" class="mod al-action modal-close waves-effect waves-red btn-flat">
        Close
      </a>
    </div>
  </div>

  <script>
    var tag = this;
    tag.items = [];

    tag.onCookieClick = function (e) {
      $('#cm-modal').modal('open')
    };

    tag.showItem = function (item) {
      tag.refs.modal.update({item: item});
      tag.refs.modal.open();
    };

    tag.updateProducts = function () {
      // Get Products from datastore
      WebStore.getProducts(function (data) {
        tag.update({items: data});
      })
    };

    tag.on('updated', function () {
      if(!tag.refs.items) { return }

      tag.refs.items.forEach(function(item){
        item.on('purchase', tag.showItem);
        item.on('view', tag.showItem);
      });
    });

    tag.on('mount', function () {
      console.log('store-list mounted!');
      $('#cm-modal').modal()
      tag.updateProducts();

      tag.refs.modal.on('purchase', function (e) {
        WebStore.purchaseItem(e.id, function () {
          tag.updateProducts();
        })
      });
    });

  </script>
</store-list>