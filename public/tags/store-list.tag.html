<store-list>

  <div id="item-container" class="row">
    <item-card ref="items" each="{ item in items }" item="{ item }"></item-card>
  </div>

  <item-modal ref="modal"></item-modal>

  <script>
    var tag = this;
    tag.items = [];

    tag.showItem = function (item) {
      tag.refs.modal.update({item: item});
      tag.refs.modal.open();
    };

    tag.updateProducts = function () {
      // Get Products from datastore
      WebStore.getProducts(function (data) {
        tag.update({items: data});
      })
    };

    tag.on('updated', function () {
      if(!tag.refs.items) { return }

      tag.refs.items.forEach(function(item){
        item.on('purchase', tag.showItem);
        item.on('view', tag.showItem);
      });
    });

    tag.on('mount', function () {
      console.log('store-list mounted!');
      tag.updateProducts();

      tag.refs.modal.on('purchase', function (e) {
        WebStore.purchaseItem(e.id, function () {
          tag.updateProducts();
        })
      });
    });

  </script>
</store-list>